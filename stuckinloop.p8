pico-8 cartridge // http://www.pico-8.com
version 36
__lua__
--startup

--const
spr_platform = 1
spr_platform_final = 2
spr_player = 33

--global varibles
platform_cnt = 20
starting_platform = 1
actors = {}
platforms = {}
player = {}

prev_button_states = btn()

function _init()
 cls()
 generate_platforms(platform_cnt)
 
 --place platforms
 place_platforms_circle(63,63,56)
 
 --change last platform spr
 platforms[#platforms].s = spr_platform_final 
 
 player = make_player(0,0)
end

function generate_platforms(n)
 for i=1,n do
  make_platform(0,0)
 end
end

function make_platform(x,y)
 p = make_actor(spr_platform,x,y)
 add(platforms, p)
end

function make_player(x,y)
 p = make_actor(spr_player,x,y)
 p.state = "static"
 p.current_platform = 1
 return p
end

function make_actor(s,x,y)
	a={
	 x = x,
	 y = y,
		s = s
	}
	add(actors,a)
	return a
end
-->8
--calculate

function _update()
	get_user_input()
	move_to_platform()
	record_button_states()	
end

function get_user_input()
 if btnpc(0) then
  player.current_platform =
   ((player.current_platform-2) % #platforms) + 1
 end
 if btnpc(1) then
  player.current_platform =
   (player.current_platform % #platforms) + 1
 end
 
end

function move_to_platform()
 local p = platforms[player.current_platform]
 if (player.x != p.x) then
  player.x = p.x
 end
 if (player.y != p.y) then
  player.y = p.y
 end
end

function btnpc(index)
 local mask = 1
 for i=1, index do
  mask *= 2
 end
 return (btn(index) and (band(prev_button_states,mask) == 0))
end

function record_button_states()
 prev_button_states = btn()
end
-->8
--render

function _draw()
	cls()
	draw_actors()
	print(player.current_platform,0,120)
end

function draw_actors()
 for a in all(actors) do
  spr(a.s,a.x,a.y)
 end
end
-->8
--helper functions

function place_platforms_circle(x,y,r,a)
 for n=1,#platforms do
  platforms[n].x = r*cos((n-1)/#platforms) + x
  platforms[n].y = r*sin((n-1)/#platforms) + y
 end
end
__gfx__
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888889999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1cc1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c1cc1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000cccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c2222c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000000000000000e0501205014050190501b0501e050230502605000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
